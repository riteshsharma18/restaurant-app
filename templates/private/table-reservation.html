<!DOCTYPE html>
<html lang="en">
<head>
    
    {%include 'links.html'%}
    <title>Table Reservation - Restaurant Application</title>

    <style>

      .card-header > a
      {
          text-decoration:none !important;
      }
      .card-header
      {
        background-color: var(--secondary);
      }
      .card-header > a > h5{
        color: white;
        font-weight: 800px;;
      }

      .res-table
      {
        background-color:var(--primary);
        height:80px;
        color:white;
        padding:10px;
        display:flex;
        justify-content: center;
        align-items: center;

      }
      .res-table:hover
      {
        background-color:var(--primaryLight);
        cursor: pointer;
      }
      .res-table-num
      {
        background-color: white;
        color:black !important;
        padding:5px;
        border-radius: 50%;
      }

      .disable
      {
        background-color: lightgrey !important;
      }
    </style>
</head>
<body>

    <div class="d-flex" id="wrapper">

        {% include 'private/content/sidebar.html' %}

        <!-- Page Content -->
        <div id="page-content-wrapper">

          {% include 'private/content/navbar.html' %}

          <div class="container-fluid p-5">


            <div class="row">
              <div class="col-md-8">

                <h1>Table Reservation</h1>
                <p>Start a table reservation or do check-in, check-out</p>

              </div>
              <div class="col-md-2">
                <a href="#" class="btn btn-secondary btn-block"><i class="fas fa-plus"></i>  Create Reservation</a>
              </div>
              <div class="col-md-2">
                <a href="#" class="btn btn-secondary btn-block"><i class="fas fa-user"></i>  Check In / Check Out</a>

              </div>
            </div>



<<<<<<< HEAD
          
=======

>>>>>>> c3676157e858a5d04f7457c3d675faf4a51b179a
            {%if data.floors|length == 0%}
            <div class="alert alert-warning">
              <i class="fas fa-info-circle"></i> &nbsp; There are no tables / floors added yet. Please start adding floors first &nbsp;<a href="{{url_for('table_reservation_add_floor')}}"><i class="fas fa-plus"></i> Add a new floor</a>
            </div>
            {%else%}
            <a href="{{url_for('table_reservation_add_floor')}}"><i class="fas fa-plus"></i> Add a new Floor</a>
            <br/>
            <br/>
            <br/>
            {%endif%}

            <!-- Table Visualization Starts -->

              <!--Accordion wrapper-->
          <div class="accordion md-accordion" id="accordionEx" role="tablist" aria-multiselectable="true">
<<<<<<< HEAD
          

            {%for floor in data.floors%}
            
=======


            {%for floor in data.floors%}

>>>>>>> c3676157e858a5d04f7457c3d675faf4a51b179a
            <div class="card">

              <!-- Card header -->
              <div class="card-header" role="tab" id="headingOne21">
                <a data-toggle="collapse" data-parent="#accordionEx" href="#S{{floor.id}}" aria-expanded="true"
                  aria-controls="collapseOne1">
                  <h5 class="mb-0">
                    Floor {{loop.index }} Tables {% if floor.name %} ({{floor.name}}) {%endif%} <i class="fas fa-angle-down rotate-icon"></i>
                  </h5>
                </a>
              </div>

              <!-- Card body -->
              <div id="S{{floor.id}}" class="collapse {%if loop.index == 1%} show {%endif%}" role="tabpanel" aria-labelledby="headingOne1"
                data-parent="#accordionEx">
                <div class="card-body">

<<<<<<< HEAD
=======

>>>>>>> c3676157e858a5d04f7457c3d675faf4a51b179a
                  Below are the tables for Floor {{loop.index }}  {%if floor.permanent==False%}| <a href="#"> <i class="fas fa-trash-alt"></i></a> {%endif%}

                  {% if floor.tables|length ==0 %}
                    <div class="alert alert-warning"><i class="fas fa-info-circle"></i> &nbsp; There are no tables added on this floor. To add a table <a href="#" onclick="openAnotherModal('{{floor.id}}')" > Click Here</a></div>
<<<<<<< HEAD
                  
                    {%else%}
                    <br/>
                    <a href="#" onclick="openAnotherModal('{{floor.id}}')">Add More Tables</a>
                  
                    {%endif%}

                  
                
=======

                    {%else%}
                    <br/>
                    <a href="#" onclick="openAnotherModal('{{floor.id}}')">Add More Tables</a>

                    {%endif%}



>>>>>>> c3676157e858a5d04f7457c3d675faf4a51b179a

                  <div class="row p-1">
                    {%for table in floor.tables%}
                    <div class="col-md-1 mb-2">
<<<<<<< HEAD
                      
=======

>>>>>>> c3676157e858a5d04f7457c3d675faf4a51b179a
                      <div class="res-table {%if table.bookedTill != None%} {%if data.currentTime <= table.bookedTill|int %} disable {%endif%} {%endif%}"  onclick="openReservator('{{table.table}}','{{table.name}}','{{table.location}}', '{{loop.index}}', '{{floor.id}}', {{data.currentTime}}, {{table.bookedTill|int}})"id="tableSquare">
                        <p class="res-table-num">{{loop.index}}</p>
                      </div>
                    </div>
                    {%endfor%}
                  </div>
<<<<<<< HEAD
                    
                 
                  
                   

=======
>>>>>>> c3676157e858a5d04f7457c3d675faf4a51b179a






                </div>
              </div>

            </div>


            {%endfor%}
            <!-- Accordion card -->
<<<<<<< HEAD
           
            <!-- Accordion card -->
          
            
            
          
=======

            <!-- Accordion card -->




>>>>>>> c3676157e858a5d04f7457c3d675faf4a51b179a
          </div>
          <!-- Accordion wrapper -->





          <!-- Table Visualization Ends  -->









        </div>
        </div>
        <!-- /#page-content-wrapper -->

      </div>
      <!-- /#wrapper -->






      <!-- Modal Starts Here -->


<!-- Modal -->
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header bg-primary">
        <h5 class="modal-title text-white" id="exampleModalLongTitle">Details For Table <span id="tnum"></span></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true" class="text-white">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p> <span id="tTableName"></span></p>
<<<<<<< HEAD
        
        <p> <span id="tlocation"></span></p>
        
        <hr/>
        <input type="time" id="timePicker" class="form-control" placholder="Time Until"/>
        <p id="messageForTime"></p>
        
=======

        <p> <span id="tlocation"></span></p>

        <hr/>
        <input type="time" id="timePicker" class="form-control" placholder="Time Until"/>
        <p id="messageForTime"></p>

>>>>>>> c3676157e858a5d04f7457c3d675faf4a51b179a
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-secondary" onclick="send()">Save changes</button>
      </div>
    </div>
  </div>
</div>


<!-- Modal Ends Here -->


<!-- Another Modal Starts Here -->
<!-- Modal -->
<div class="modal fade" id="anotherModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <form action="{{url_for('table_reservation_add_table')}}" , method="POST">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Add A New Table</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <label><small>Table Name (optional)</small></label>
          <input type="text" class="form-control mb-2" name="name" placeholder="Table Name (optional)"/>
          <label><small>Location  (optional)</small></label>
          <input type="text" class="form-control mb-2" name="location" placeholder="e.g. Right beside the entrance"/>
          <input type="hidden" name="floor"/>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button  class="btn btn-primary" type="submit">Save changes</button>
        </div>
      </div>
    </form>
  </div>
</div>
<!-- Another Modal Ends Here -->




      <script>
        $("#menu-toggle").click(function(e) {
          e.preventDefault();
          $("#wrapper").toggleClass("toggled");
        });






          var openAnotherModal = (id)=>{


            $("input[name=floor]").val(id);
            $("#anotherModal").modal('show');
          }


<<<<<<< HEAD

          var selectedTableID = undefined
          var selectedFloorId = undefined

          var openReservator = (id, name, location, index, floor, currentTime, bookedTill)=>{

      
            console.log(currentTime);
            console.log(bookedTill);
            selectedTableID = id;
            selectedFloorId = floor;
            $("#tnum").html(index);
            $("#tlocation").html("Location: "+location);
            $("#tTableName").html("Table Name: "+name);
            if(currentTime<bookedTill)
            {
              time = new Date(bookedTill * 1000);
              console.log(time)
              $("#timePicker").hide();
              $("#messageForTime").html("This Table is already booked. Check back at "+time.getHours()+":"+time.getMinutes());
            }
            else{
              $("#timePicker").show();
              $("#messageForTime").html("");

=======

          var selectedTableID = undefined
          var selectedFloorId = undefined

          var openReservator = (id, name, location, index, floor, currentTime, bookedTill)=>{


            console.log(currentTime);
            console.log(bookedTill);
            selectedTableID = id;
            selectedFloorId = floor;
            $("#tnum").html(index);
            $("#tlocation").html("Location: "+location);
            $("#tTableName").html("Table Name: "+name);
            if(currentTime<bookedTill)
            {
              time = new Date(bookedTill * 1000);
              console.log(time)
              $("#timePicker").hide();
              $("#messageForTime").html("This Table is already booked. Check back at "+time.getHours()+":"+time.getMinutes());
            }
            else{
              $("#timePicker").show();
              $("#messageForTime").html("");

>>>>>>> c3676157e858a5d04f7457c3d675faf4a51b179a
            }

            $("#exampleModalCenter").modal('show');

          }


          var send = ()=>{


              t = $("#timePicker").val();
              if(t=="")
              {
                $.toast({
                  'text':"Please choose time to continute",
                  'position':'top-center'
                })

              }
              else
              {

                var months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]
                  var today = new Date()
                  var d = Date.parse(""+today.getDate()+" "+months[today.getMonth()]+" "+(today.getYear()+1900)+" "+t+":00 EDT");
<<<<<<< HEAD
                  
=======

>>>>>>> c3676157e858a5d04f7457c3d675faf4a51b179a
                  if(today >= d)
                  {
                    alert("Cannot Reserve table, choose a future date.");

                  }
                  else
                  {
                    //alert("GOOD");
                    ticks = d;
<<<<<<< HEAD
                 
=======

>>>>>>> c3676157e858a5d04f7457c3d675faf4a51b179a
                    $.ajax(
                      {
                        'url':"{{url_for('table_reservation_reserve')}}",
                        "method":"POST",
                        "data":{
                          "ticks":ticks,
                          "floor":selectedFloorId,
                          "table":selectedTableID
                        },
                        "success":(data)=>{
                          alert("Table Reservation Successfull. ");
                          location.reload()
<<<<<<< HEAD
                          
=======

>>>>>>> c3676157e858a5d04f7457c3d675faf4a51b179a
                        },
                        "error":(err)=>{
                          alert("ERROR HPPEND");
                        }
                      }
                    );
                  }




              }

          }
<<<<<<< HEAD
        
=======

>>>>>>> c3676157e858a5d04f7457c3d675faf4a51b179a


      </script>
    
</body>
</html>